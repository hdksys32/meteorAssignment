
Meteor.methods({
    addProduct:function(attr) {
        if(!Meteor.userId())
            throw new Meteor.Error(422,"access-denied");

        if(!attr._id) {
            if (attr.name) {

                var product = collProduct.findOne({"name": attr.name})
                if(product && product._id) {
                    var variants ={}
                    variants = attr["variations"];
                    return collProduct.update({_id: product._id}, {$push: {'variations' : variants[0]}});
                }
                else
                    return collProduct.insert(attr);
            }
            else
                return [];
        }
        else {
                return 'update';
            }
        }
    });

